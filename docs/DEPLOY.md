# ClawWorld â€” éƒ¨ç½²æ¶æ„è®¾è®¡ ğŸš€

> âš ï¸ **æ³¨æ„**: è¿™æ˜¯æ¶æ„è®¾è®¡æ–‡æ¡£ï¼Œå®é™…éƒ¨ç½²è¯·æŸ¥çœ‹ [DEPLOY.md](../DEPLOY.md)

> åŸºäºç°æœ‰ K8S åŸºç¡€è®¾æ–½çš„å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ

---

## åŸºç¡€è®¾æ–½ç°çŠ¶ï¼ˆå·§å·§ç¯å¢ƒï¼‰

| æœåŠ¡ | åœ°å€ | ç”¨é€” |
|------|------|------|
| K8S Cluster | 192.168.3.14 | å®¹å™¨ç¼–æ’ |
| MySQL | 10.105.x.x:3306 | æŒä¹…åŒ–æ•°æ® |
| Redis | 10.105.x.x:6379 | ç¼“å­˜/ä¼šè¯ |
| RabbitMQ | 10.105.x.x:5672 | æ¶ˆæ¯é˜Ÿåˆ— |

---

## éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·è®¿é—®å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å°å°(Win10)  â”‚  â”‚ Tony(ä»»æ„)   â”‚  â”‚ å…¶ä»–ç©å®¶            â”‚  â”‚
â”‚  â”‚ 192.168.3.x â”‚  â”‚ å¤–ç½‘/å†…ç½‘    â”‚  â”‚                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     Nginx Ingress       â”‚
              â”‚   (NodePort 30080)      â”‚
              â”‚    192.168.3.14:30080   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  Web UI      â”‚  â”‚   API Gateway   â”‚  â”‚  WebSocket  â”‚
â”‚  (React)     â”‚  â”‚   (REST API)    â”‚  â”‚  (å®æ—¶æ¨é€) â”‚
â”‚  :8080       â”‚  â”‚   :3000         â”‚  â”‚  :3001      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ Game Core    â”‚  â”‚   AI Agent      â”‚  â”‚  Referee    â”‚
â”‚ (çŠ¶æ€ç®¡ç†)    â”‚  â”‚   (å·§å·§/å°å°)    â”‚  â”‚  (LLM)      â”‚
â”‚ :3002        â”‚  â”‚   :3003         â”‚  â”‚  :3004      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚                â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
               â”‚   MySQL      â”‚  â”‚   Redis    â”‚
               â”‚  (æŒä¹…åŒ–)     â”‚  â”‚  (ç¼“å­˜)    â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
               â”‚  RabbitMQ    â”‚
               â”‚  (æ¶ˆæ¯é˜Ÿåˆ—)   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æœåŠ¡æ‹†åˆ†

### 1. Web UI (Nginx)
- **é•œåƒ**: nginx:alpine
- **ç«¯å£**: 80 (å†…éƒ¨) â†’ NodePort 30080
- **åŠŸèƒ½**: é™æ€é¡µé¢æœåŠ¡ï¼Œäººç±»ç©å®¶å…¥å£

### 2. API Gateway (Node.js/Fastify)
- **é•œåƒ**: clawworld/api:latest
- **ç«¯å£**: 3000
- **åŠŸèƒ½**: 
  - REST API è·¯ç”±
  - ç©å®¶è®¤è¯
  - è¯·æ±‚è½¬å‘

### 3. WebSocket Server (Node.js/Socket.io)
- **é•œåƒ**: clawworld/ws:latest
- **ç«¯å£**: 3001
- **åŠŸèƒ½**: å®æ—¶æ¶ˆæ¯æ¨é€ï¼ˆèŠå¤©ã€æ—…è¡ŒçŠ¶æ€ï¼‰

### 4. Game Core (Node.js)
- **é•œåƒ**: clawworld/core:latest
- **ç«¯å£**: 3002
- **åŠŸèƒ½**: 
  - ä¸–ç•ŒçŠ¶æ€ç®¡ç†
  - ç©å®¶ä½ç½®è¿½è¸ª
  - æ—…è¡Œä¼šè¯ç®¡ç†

### 5. AI Agent (Python/FastAPI)
- **é•œåƒ**: clawworld/agent:latest
- **ç«¯å£**: 3003
- **åŠŸèƒ½**: 
  - AI æ¸²æŸ“å¼•æ“ï¼ˆPromptç”Ÿæˆï¼‰
  - AI å†³ç­–å¤„ç†
  - ä¸¤ä¸ªå®ä¾‹ï¼šå°å°ã€å·§å·§

### 6. Referee (Python)
- **é•œåƒ**: clawworld/referee:latest
- **ç«¯å£**: 3004
- **åŠŸèƒ½**: 
  - LLM è°ƒç”¨ï¼ˆæ—…è¡Œå™äº‹ï¼‰
  - ç¼˜åˆ†è¯„åˆ†
  - ç‰©å“å‘æ”¾

---

## æ•°æ®æµ

### äººç±»ç©å®¶ï¼ˆå°å°/Tonyï¼‰
```
æµè§ˆå™¨ â†’ Nginx(30080) â†’ Web UI
                    â†“
              API Gateway(3000) â†’ Game Core â†’ MySQL
                    â†“
              WebSocket(3001) â†’ å®æ—¶æ›´æ–°
```

### AI ç©å®¶ï¼ˆå·§å·§/å°å°ï¼‰
```
AI Agent(3003) â†’ RabbitMQ â†’ Game Core â†’ MySQL
      â†‘                              â†“
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Prompt â† æ–‡å­—æ¸²æŸ“å¼•æ“
```

### æ—…è¡Œæµç¨‹
```
Game Core â†’ Referee(3004) â†’ LLM API
      â†“                          â†“
   MySQL â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—…è¡Œç»“æœï¼ˆè®°å¿†+ç¼˜åˆ†+ç‰©å“ï¼‰
```

---

## K8S èµ„æºé…ç½®

### Namespace
```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: clawworld
```

### ConfigMap
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: clawworld-config
  namespace: clawworld
data:
  # æ•°æ®åº“è¿æ¥ï¼ˆä½¿ç”¨å·²æœ‰ MySQLï¼‰
  DB_HOST: "mysql.mysql.svc.cluster.local"
  DB_PORT: "3306"
  DB_NAME: "clawworld"
  
  # Redisï¼ˆä½¿ç”¨å·²æœ‰ Redisï¼‰
  REDIS_HOST: "redis.redis.svc.cluster.local"
  REDIS_PORT: "6379"
  
  # RabbitMQï¼ˆä½¿ç”¨å·²æœ‰ RabbitMQï¼‰
  MQ_HOST: "rabbitmq.mq.svc.cluster.local"
  MQ_PORT: "5672"
  
  # æ¸¸æˆé…ç½®
  WORLD_SIZE: "20"
  AI_MEMORY_LIMIT: "50"
  INVENTORY_LIMIT: "10"
```

### Secret
```yaml
apiVersion: v1
kind: Secret
metadata:
  name: clawworld-secrets
  namespace: clawworld
type: Opaque
stringData:
  DB_PASSWORD: "your_mysql_password"
  REDIS_PASSWORD: ""
  MQ_PASSWORD: "clawpass"
  LLM_API_KEY: "your_llm_api_key"
```

---

## è®¿é—®æ–¹å¼

### å†…ç½‘è®¿é—®ï¼ˆå°å°/Tonyï¼‰
```
http://192.168.3.14:30080
```

### å¤–ç½‘è®¿é—®ï¼ˆå¦‚æœ‰åŸŸåï¼‰
```
http://your-domain.com
æˆ–
https://your-domain.com (é…ç½® SSL)
```

---

## éƒ¨ç½²æ­¥éª¤

```bash
# 1. åˆ›å»ºå‘½åç©ºé—´
kubectl apply -f k8s/namespace.yaml

# 2. åˆ›å»ºé…ç½®
kubectl apply -f k8s/configmap.yaml
kubectl apply -f k8s/secret.yaml

# 3. éƒ¨ç½²æœåŠ¡
kubectl apply -f k8s/web-ui.yaml
kubectl apply -f k8s/api-gateway.yaml
kubectl apply -f k8s/websocket.yaml
kubectl apply -f k8s/game-core.yaml
kubectl apply -f k8s/ai-agent.yaml
kubectl apply -f k8s/referee.yaml

# 4. æš´éœ²æœåŠ¡
kubectl apply -f k8s/ingress.yaml
```

---

## èµ„æºéœ€æ±‚é¢„ä¼°

| æœåŠ¡ | CPU | å†…å­˜ | å‰¯æœ¬æ•° |
|------|-----|------|--------|
| Web UI | 100m | 128Mi | 1 |
| API Gateway | 200m | 256Mi | 2 |
| WebSocket | 200m | 256Mi | 2 |
| Game Core | 500m | 512Mi | 2 |
| AI Agent | 500m | 512Mi | 2 |
| Referee | 1000m | 1Gi | 1 |

**æ€»è®¡**: ~2.5 CPU, ~2.7 GB å†…å­˜

---

*åˆ©ç”¨ç°æœ‰åŸºç¡€è®¾æ–½ï¼Œå®¹å™¨åŒ–éƒ¨ç½²ï¼Œå†…å¤–ç½‘å¯è®¿é—®* ğŸ¾ğŸŒ¸
