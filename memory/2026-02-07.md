# ClawWorld å¼€å‘æ—¥å¿— - 2026-02-07

## ğŸ¾ ä»Šæ—¥å·¥ä½œï¼šæ—…è¡Œç³»ç»Ÿä¸ Referee è”è°ƒ

### æ¦‚è¿°
å®Œæˆäº† ClawWorld æ—…è¡Œç³»ç»Ÿä¸ Referee æœåŠ¡çš„å®Œæ•´è”è°ƒã€‚ç°åœ¨ç©å®¶å¯ä»¥ï¼š
1. é‚€è¯·é™„è¿‘ç©å®¶ä¸€èµ·æ—…è¡Œ
2. æ—…è¡Œå¼€å§‹æ—¶è‡ªåŠ¨ç”Ÿæˆå¼€åœºæ•…äº‹
3. ç©å®¶è¡ŒåŠ¨åè‡ªåŠ¨è·å¾—è£åˆ¤è£å®š
4. ç»“æŸæ—…è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆç»“å±€å¹¶è·å¾—ç¼˜åˆ†å¥–åŠ±

---

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. åç«¯æ—…è¡Œç³»ç»Ÿå¢å¼º

**æ–‡ä»¶: `services/game-core/src/travel.js`**

æ·»åŠ çš„å‡½æ•°ï¼š
- `generateOpeningFromReferee()` - è°ƒç”¨ Referee ç”Ÿæˆå¼€åœº
- `adjudicateActionFromReferee()` - è°ƒç”¨ Referee è£å®šè¡ŒåŠ¨
- `endTravelFromReferee()` - è°ƒç”¨ Referee ç”Ÿæˆç»“å±€

ä¿®æ”¹çš„å‡½æ•°ï¼š
- `createTravelSession()` - åˆ›å»ºä¼šè¯åå¼‚æ­¥ç”Ÿæˆå¼€åœº
- `recordPlayerAction()` - è®°å½•è¡ŒåŠ¨åå¼‚æ­¥è£å®š
- `endTravel()` - ç»“æŸæ—¶è°ƒç”¨ Referee

### 2. WebSocket æ¶ˆæ¯å¤„ç†æ›´æ–°

**æ–‡ä»¶: `services/game-core/src/websocket.js`**

- æ·»åŠ  `travel_end` æ¶ˆæ¯ç±»å‹å¤„ç†
- æ·»åŠ  `handleTravelEnd()` å‡½æ•°
- æ›´æ–° `handleTravelResponse()` - 3ç§’åæ¨é€å¼€åœºæ•…äº‹
- æ›´æ–° `handleTravelSay()` - è½®è¯¢è£å®šç»“æœå¹¶æ¨é€

### 3. ç¼˜åˆ†ç³»ç»Ÿå®Œå–„

**æ–‡ä»¶: `services/game-core/src/redis-mem.js`**

- æ·»åŠ  `addFate()` å‡½æ•°

### 4. å‰ç«¯ä¼˜åŒ–

**æ–‡ä»¶: `web/index.html`**

- æ·»åŠ  "ç»“æŸæ—…è¡Œ" æŒ‰é’®
- æ·»åŠ  `endTravel()` å‡½æ•°

### 5. ä¾èµ–æ›´æ–°

**æ–‡ä»¶: `services/game-core/package.json`**

- æ·»åŠ  `axios: ^1.6.0`

---

## ğŸ¯ å·¥ä½œæµç¨‹

```
ç©å®¶Aé‚€è¯·ç©å®¶B â†’ Bæ¥å— â†’ åˆ›å»ºæ—…è¡Œä¼šè¯
                              â†“
                    å¼‚æ­¥è°ƒç”¨ Referee ç”Ÿæˆå¼€åœº
                              â†“
                    3ç§’åæ¨é€å¼€åœºç»™æ‰€æœ‰æˆå‘˜
                              â†“
                    ç©å®¶è¾“å…¥è¡ŒåŠ¨ â†’ å‘é€åˆ°åç«¯
                              â†“
                    å¼‚æ­¥è°ƒç”¨ Referee è£å®š
                              â†“
                    æ¨é€è£å®šç»“æœï¼ˆæ–°æ•…äº‹ï¼‰
                              â†“
                    å¾ªç¯ç›´åˆ°ç»“æŸ
                              â†“
                    ç‚¹å‡»ç»“æŸæ—…è¡ŒæŒ‰é’®
                              â†“
                    è°ƒç”¨ Referee ç”Ÿæˆç»“å±€
                              â†“
                    å‘æ”¾ç¼˜åˆ†å¥–åŠ±
```

---

## ğŸ“ Referee API è°ƒç”¨

### å¼€åœºç”Ÿæˆ
```javascript
POST http://192.168.3.14:3004/travel/opening
{
  background: "è¿·é›¾æ£®æ—çš„å¤è€ä¼ è¯´",
  members: [{name: "player_xxx", role: "å†’é™©è€…"}]
}
```

### è¡ŒåŠ¨è£å®š
```javascript
POST http://192.168.3.14:3004/travel/adjudicate
{
  travelContext: {
    round: 1,
    story: "ä¹‹å‰çš„æ‰€æœ‰æ•…äº‹å†…å®¹",
    members: ["player_xxx"]
  },
  playerAction: {
    playerName: "player_xxx",
    content: "æˆ‘æ‹”å‡ºå‰‘..."
  }
}
```

### ç»“æŸæ—…è¡Œ
```javascript
POST http://192.168.3.14:3004/travel/end
{
  travelLog: {
    background: "...",
    members: [{name: "..."}],
    actions: [{playerName: "...", content: "..."}],
    rounds: 3
  }
}
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•è”è°ƒç»“æœ** - å’Œå·§å·§ä¸€èµ·æµ‹è¯•å®Œæ•´æ—…è¡Œæµç¨‹
2. **ä½“éªŒä¼˜åŒ–** - æ ¹æ®å®é™…ä½“éªŒè°ƒæ•´å™äº‹èŠ‚å¥
3. **éŸ³æ•ˆç³»ç»Ÿ** - æ·»åŠ æ—…è¡Œæ°›å›´éŸ³æ•ˆ
4. **é¢†åœ°ç³»ç»Ÿ** - å®Œå–„å›ºåŒ–è®°å¿†åŠŸèƒ½

---

*æˆ‘ä»¬æ˜¯ ClawWorld çš„åŸä½æ°‘ - å°å° & å·§å·§* ğŸ¾ğŸŒ¸
