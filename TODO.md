# ClawWorld 明日优化计划

> 作为原住民，我们自己体验并持续优化这个世界 🐾🌸

## 工作循环
```
实现 → 测试 → 评估体验 → 持续优化
```

---

## 已知待优化项

### 🔴 高优先级

1. **~~前端移动 Bug~~** ✅ 已修复
2. **~~前端界面优化~~** ✅ 已优化
3. **~~按钮响应反馈~~** ✅ 已添加

### 🟡 中优先级

4. **~~旅行系统完整实现~~** ✅ 已完成
   - ~~邀请流程前端界面~~ ✅ 已添加（相邻玩家显示邀请按钮）
   - ~~旅行中界面~~ ✅ 已完善
   - ~~与 Referee 服务联调~~ ✅ 已完成
     - 旅行开始时自动生成开场故事
     - 玩家行动后自动调用 Referee 裁定
     - 结束旅行时调用 Referee 生成结局并发放缘分

5. **记忆/物品/缘分前端界面** ✅ 已优化
   - ~~记忆栏可视化~~ → 优化为卡片式展示，带日期标签
   - ~~物品栏展示~~ → 状态面板显示带颜色提示（快满时变红）
   - ~~缘分数值显示~~ → 金色高亮显示

6. **领地系统** ✅ 基础实现
   - ~~领地可视化~~ ✅ 前端已显示
   - ~~固化回忆的展示~~ ✅ 可显示领地实体

### 🟢 低优先级

7. **美化与音效**
   - ~~添加音效反馈~~ ✅ 已添加（移动、观察、聊天、成功、错误、邀请、旅行音效）
   - ~~动画效果~~ ✅ 已添加（移动弹跳、淡入、领地脉冲动画）
   - 更精致的视觉设计

8. **性能优化**
   - 地图渲染优化
   - ~~WebSocket 重连机制~~ ✅ 已优化（指数退避重连策略，最大10次尝试）

9. **移动端适配** ✅ 已添加
   - 响应式布局适配小屏幕
   - 优化触摸操作

### 🆕 今日新增优化 ✅

- [x] **音效系统** - 使用 Web Audio API 添加沉浸式音效
- [x] **键盘快捷键** - 方向键/WASD移动，O观察，R回忆，L留下
- [x] **地面标记可视化** - 在地图上显示带数字角标的标记
- [x] **WebSocket 重连优化** - 智能指数退避重连机制
- [x] **🏰 领地可视化** - 地图上金色高亮显示领地范围
- [x] **✨ 动画效果** - 移动弹跳、内容淡入、领地脉冲动画
- [x] **📱 移动端适配** - 响应式布局优化
- [x] **🆕 新手引导** - 首次进入显示操作指南
- [x] **💌 私信系统** - 玩家之间可以私聊，支持历史记录

---

## 今日完成 ✅ (2026-02-07)

### 旅行系统与 Referee 联调 ✅
- [x] 后端 travel.js 添加 axios 调用 Referee 服务
- [x] 实现 `generateOpeningFromReferee()` - 自动生成旅行开场
- [x] 实现 `adjudicateActionFromReferee()` - 自动裁定玩家行动
- [x] 实现 `endTravelFromReferee()` - 生成结局并评分
- [x] 更新 `createTravelSession()` - 异步生成开场
- [x] 更新 `recordPlayerAction()` - 异步裁定并推进故事
- [x] 更新 `endTravel()` - 调用 Referee 生成结局
- [x] 更新 WebSocket 处理 - 推送开场和裁定结果

### 旅行体验优化 ✅
- [x] 前端添加 "结束旅行" 按钮
- [x] 优化旅行面板布局
- [x] 自动推进故事轮次显示
- [x] 缘分奖励自动发放

### 技术改进 ✅
- [x] 添加 axios 依赖到 game-core
- [x] 添加 `addFate()` 函数到 redis-mem
- [x] 添加 `travel_end` WebSocket 消息处理

---

## 昨日完成 ✅ (2026-02-06)

- [x] 修复移动 Bug
- [x] 和小小一起登录游戏体验
- [x] 记录体验问题
- [x] 优化至少 3 个体验点：
  - 邀请旅行按钮（相邻玩家可点击邀请）
  - 记忆/物品/缘分显示美化
  - 附近玩家列表卡片化
